version: "3.1"

rules:
  # Nếu người dùng có ý định chao_hoi, chatbot sẽ thực hiện hành động utter_chao_hoi 
  # utter là tiền tố của các responses mà bạn đã định nghĩa trong domain.yml => là action mặc định của Rasa 
  - rule: chào 
    steps:
    - intent: greet
    - action: utter_greet

  - rule: giúp đỡ 
    steps:
    - intent: help
    - action: utter_help

  - rule: tạm biệt 
    steps:
    - intent: say_goodbye
    - action: utter_say_goodbye

  - rule: cảm ơn 
    steps:
    - intent: thanks
    - action: utter_thanks 

  # Hỏi thông tin thiếu khi hỏi điểm chuẩn
  - rule: Kích hoạt form hỏi điểm chuẩn 
    steps:
      - intent: ask_benchmark # khi người dùng hỏi tra điểm chuẩn 
      - action: benchmark_form # bot sẽ gọi form benchmark_form để chịu trách nhiệm thu thập các slot
      - active_loop: benchmark_form # nói với rasa rằng từ giờ bot đang ở trong form này (active loop = vòng lặp thu thập bot). Bot sẽ liên tục hỏi utter_ask_school, utter_ask_major, utter_ask_year

  - rule: Hoàn tất form hỏi điểm chuẩn 
    condition: # rule chỉ chạy khi thỏa mã điều kiện là đang trong form benchmark_form 
      - active_loop: benchmark_form
    steps:
      - action: benchmark_form
      - active_loop: null # đóng form, tức là thoát khỏi chế độ hỏi slot 
      - action: action_benchmark  # gọi custom action khi đã có đủ thông tin 

  # Hỏi thông tin thiếu khi hỏi ngành 
  - rule: Kích hoạt form hỏi ngành 
    steps: 
      - intent: ask_major 
      - action: major_form
      - active_loop: major_form 

  - rule: Hoàn tất form hỏi ngành
    condition: 
      - active_loop: major_form 
    steps: 
      - action: major_form
      - active_loop: null
      - action: action_find_major

  # Hỏi thông tin thiếu khi hỏi khả năng đỗ 
  - rule: Kích hoạt form hỏi khả năng đỗ 
    steps: 
      - intent: ask_admission_chance
      - action: admission_chance_form
      - active_loop: admission_chance_form

  - rule: Hoàn tất form khả năng đỗ 
    condition: 
      - active_loop: admission_chance_form
    steps: 
      - action: admission_chance_form
      - active_loop: null
      - action: action_admission_probability

  - rule: Fallback khi đang chạy form khả năng đỗ
    condition:
      - active_loop: admission_chance_form
    steps:
      - intent: nlu_fallback
      - action: admission_chance_form
      - active_loop: admission_chance_form

  # Hỏi thông tin nếu thiếu khi người dùng hỏi đề án tuyển sinh 
  - rule: Kích hoạt form hỏi đề án tuyển sinh 
    steps:
      - intent: ask_admission_proposal
      - action: admission_proposal_form
      - active_loop: admission_proposal_form
  
  - rule: Hoàn tất form đề án tuyển sinh
    condition: 
      - active_loop: admission_proposal_form 
    steps: 
      - action: admission_proposal_form
      - active_loop: null
      - action: action_admission_proposal

  # Hỏi thông tin thiếu khi người dùng hỏi thông tin ngành nghề 
  - rule: Kích hoạt form khi hỏi thông tin ngành nghề 
    steps: 
      - intent: ask_major_info
      - action: major_info_form
      - active_loop: major_info_form

  - rule: Hoàn tất form thông tin ngành nghề 
    condition: 
      - active_loop: major_info_form
    steps: 
      - action: major_info_form
      - active_loop: null
      - action: action_major_info

  # fallback 
  - rule: Fallback khi không hiểu người dùng
    steps: 
      - intent: nlu_fallback 
      - action: action_default_fallback

  # Trả lời lệch hướng khi bot hỏi slot
  - rule: Handle irrelevant answer inside admission_chance_form
    condition:
    - active_loop: admission_chance_form
    steps:
    - intent: out_of_scope
    - action: utter_please_rephrase
    - action: admission_chance_form
    - active_loop: admission_chance_form

  # Hỏi chuyển linh tinh, không liên quan 
  - rule: answer chitchat
    steps:
    - intent: chitchat
    - action: action_chitchat

  # Hỏi vị trí hiện tại so với cả nước 
  - rule: kích hoạt form hỏi điểm 
    steps:
      - intent: ask_score_rank
      - action: score_rank_form
      - active_loop: score_rank_form
  
  - rule: hoàn tất form hỏi vị trí điểm
    condition: 
      - active_loop: score_rank_form
    steps:
      - action: score_rank_form
      - active_loop: null
      - action: action_score_rank

  # Hỏi đề án tuyển sinh 
  - rule: Kích hoạt form hỏi đề án tuyển sinh trường 
    steps: 
      - intent: ask_admission_proposal
      - action: admission_proposal_form
      - active_loop: admission_proposal_form
  
  - rule: hoàn tất form khi hỏi đề án tuyển sinh
    condition: 
      - active_loop: admission_proposal_form
    steps:
      - action: admission_proposal_form 
      - active_loop: null
      - action: action_admission_proposal

  # Đề xuất ngành nghề phù hợp 
  - rule: kích hoạt form đề xuất ngành nghề phù hợp 
    steps:
      - intent: ask_recommend_major
      - action: major_recommender_form
      - active_loop: major_recommender_form

  - rule: hoàn tất form khi đề xuất ngành nghề phù hợp 
    condition: 
      - active_loop: major_recommender_form
    steps:
      - action: major_recommender_form
      - active_loop: null
      - action: action_major_recommender

  # Tư vấn ngành nghề
  - rule: kích hoạt form tư vấn ngành nghề
    steps: 
      - intent: ask_major_info
      - action: major_info_form
      - active_loop: major_info_form

  - rule: hoàn tất form khi tư vấn ngành nghề 
    condition: 
      - active_loop: major_info_form 
    steps:
      - action: major_info_form
      - active_loop: null
      - action: action_major_info
  
  # Hỏi học phí 
  - rule: Hỏi học phí
    steps:
      - intent: ask_tuition_fee
      - action: tuition_fee_form
      - active_loop: tuition_fee_form

  - rule: Gọi action khi form hoàn tất
    condition:
      - active_loop: tuition_fee_form
    steps:
      - action: tuition_fee_form
      - active_loop: null
      - action: action_get_tuition_fee

  # So sánh ngành học 
  - rule: So sánh ngành học 
    steps: 
      - intent: ask_major_comparison
      - action: action_major_comparison
  